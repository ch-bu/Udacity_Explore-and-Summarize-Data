World Food Facts by Christian Burkhart
========================================================


The **World Food Facts** dataset is a french initiative of food products around the world. The dataset is provided by **Open Food Facts** under an Open Database License (http://opendatacommons.org/licenses/odbl/1.0/). Customers and food manufacturar can freely add products.

In this Exploratory Data Analysis I will try to get some insights into the food products of Germany. Being from Germany I am interested in the nutritional value of the products found in the German supermarket.


```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
library(ggplot2)
library(dplyr)
library(reshape2)
```

```{r, echo=FALSE}
## Variables
color_fill <- "#CD6771"
color_two <- "#0D5047"
color_border <- "#F6A4AC"

# Helper functions for the code

histogram_helper <- function(variable, xlab, bwidth) {
  histogram <- ggplot(food_data_germany, aes(variable)) +
    geom_histogram(binwidth = bwidth, fill = color_fill, colour = color_border) +
    labs(x = xlab)
  return(histogram)
}
```

```{r echo=FALSE, cache=TRUE, Load_the_Data}
setwd("~/Repositories/Udacity_Explore-and-Summarize-Data")
food_data <- read.csv(file.path("data", "FoodFacts.csv"), header = TRUE, sep = ",", stringsAsFactors = TRUE)
```

# Data Cleaning
```{r, echo=FALSE}
dim(food_data)
```

There are in total `r nrow(food_data)` food products in the dataset. Each food product has `r ncol(food_data)` variables. Not every variable will be of interest for this analysis. I will focus my analysis on products from Germany.

```{r, echo=FALSE}
food_data_germany <- filter(food_data, countries_en == "Germany")
```

When I filter the database for German products the entire database is reduced `r nrow(food_data_germany)` products. In order to select variables that contain meaningful information we have to filter the dataset for NAs. Variables with a lot of NAs should not be included in the analysis. For this analysis I will set the cutoff for variables that have less than 40% of NAs.

```{r, echo=FALSE, warning=FALSE}
# Code taken and accustomed from
# https://www.kaggle.com/jelaurent/d/openfoodfacts/world-food-facts/openfoodfacts-exploring-the-dataset/notebook
na_variables <- food_data_germany %>%
  melt(measure.vars = 1:159) %>%
  group_by(variable) %>% 
  summarize(perc_na = round(sum(is.na(value))/length(value), digits = 3)) %>%
  arrange(desc(perc_na)) %>%
  filter(perc_na > .4) %>%
  as.data.frame
```

```{r, echo=FALSE, warning=FALSE, cache=TRUE}
food_germany <- select(food_data_germany, product_name, generic_name,
                                      brands, categories_en, origins, pnns_groups_1,
                                      pnns_groups_2, manufacturing_places, additives_en,
                                      nutrition_grade_fr, main_category_en, energy_100g, 
                                      fat_100g, saturated_fat_100g, carbohydrates_100g, 
                                      sugars_100g, proteins_100g, salt_100g, 
                                      nutrition_score_fr_100g, nutrition_score_uk_100g)
glimpse(food_germany)
```

We managed to drill down the database to `r ncol(food_germany)` variables. There variables now contain less than 40% of NAs and can be used for further analysis.


# Univariate Plots Section

## Macronutritions
I will begin to explore the **macronutritions** in the dataset. That is, **fat**, **proteins**, and **carbohydrates**. 

```{r, echo=FALSE}
histogram_helper(food_germany$fat_100g, "fat_100g", bwidth = 2)
```

Most products do not contain a lot of **fat**. The distribution is **skewed left**. Very few products contain a lot of fat. 

For the purpose of a healthy diet is is crucial to investigate **saturated fat** as it has been linked to cardiovascular diseases.

```{r, echo=FALSE}
histogram_helper(food_germany$saturated_fat_100g, "saturated_fat_100g", bwidth = 2)
```

It seems that most products do not contain a lot of **saturated fat**. Indeed there is tiny peak of products that contain around 50g of saturated fat per 100g.

```{r, echo=FALSE}
histogram_helper(food_germany$proteins_100g, "protein_100g", bwidth = 2)
```

The distribution of **protein** is more **skewed to the left** than the distribution of fat. There are few products with a lot of protein. I suppose these are **food supplements** for weight loss or muscle training. 

```{r, echo=FALSE}
histogram_helper(food_germany$carbohydrates_100g, "carbohydrates_100g", bwidth = 2)
```

The distribution of **carbohydrates** is more evenly distributed than the distribution of fat or proteins. Most products do not contain a lot of carbohydrates. The distribution is slightly **bimodal**, indicating two different sort of products. 

## Nutritional Value
The database has two variables that give information about the nutritional value of the products. There is a score from France (**nutrition_score_fr_100g**) and a score from the UK (**nutrition_score_uk_100g**). Let us see how they differ.

```{r, echo=FALSE}
nutrition_score_dataframe <- food_germany %>%
  melt(measure.vars = 19:20)
  
ggplot(nutrition_score_dataframe, aes(x = value)) +
  geom_histogram(binwidth = 2, fill = color_fill, colour = color_border) +
    labs(x = "Nutrional Value") +
    facet_wrap(~ variable)

ggplot(nutrition_score_dataframe, aes(x = value, fill = variable)) +
  geom_histogram(binwidth = 1, position="identity", alpha = 0.2) +
    labs(x = "Nutrional Value")
```

Obviously the variables are not drastically different from another. For further analysis I will stick to the **French**.

From a first glimpse at the nutritional value, the distribution looks a little bit **bimodal**. There is a high peak at around a score of 0. These might be water products that are neither nutritional valuable nor non-valuable. Another peak seems to be around a score of 15. 

Let us dive deeper into the nutritional value of different food categories. The **pnns_groups_1** variable contains information of the product types.

```{r, echo=FALSE}
# Borrowed idea from jlaurent:
# https://www.kaggle.com/jelaurent/d/openfoodfacts/world-food-facts/openfoodfacts-exploring-the-dataset/notebook
food_germany$pnns_groups_1 <- gsub("^([a-z])(\\w+)", "\\U\\1\\L\\2", food_germany$pnns_groups_1, perl = TRUE)
food_germany$pnns_groups_1 <- as.factor(gsub("-", " ", food_germany$pnns_groups_1))

ggplot(food_germany, aes(x = nutrition_score_fr_100g)) +
  geom_histogram(binwidth = 2, fill = color_fill, colour = color_border) +
    labs(x = "Nutrional Value") +
    facet_wrap(~ pnns_groups_1)
```

**Sugary** snacks obviously are not very healthy. Appart from sugary snacks there is no product type that is of bad nutritional value per se. **Cereals and potatoes** seem to be beneficial for health. The same goes for **Fruits and vegetables**. **Milk and dairy products** have a bimodal distribution. This indicates that half of these products are not very healthy. **Beverages** by and large seem to be reasonably good. The peak of the distribution might be because of **water products**. 

# Univariate Analysis

### What is the structure of your dataset?



### What is/are the main feature(s) of interest in your dataset?

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

### Did you create any new variables from existing variables in the dataset?

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?



# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}

```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
