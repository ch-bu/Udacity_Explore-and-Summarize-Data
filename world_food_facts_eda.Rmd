---
output: 
  html_document: 
    theme: flatly
---
World Food Facts by Christian Burkhart
========================================================


The **World Food Facts** dataset is a french initiative of food products around the world. The dataset is provided by **Open Food Facts** under an Open Database License (http://opendatacommons.org/licenses/odbl/1.0/). Customers and food manufacturers can freely add products.

In this Exploratory Data Analysis I will try to get some insights into the food products of Germany. Being from Germany I am interested in the nutritional value of the products found in the German supermarket.


```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
library(ggplot2)
library(dplyr)
library(reshape2)
```

```{r, echo=FALSE}
## Variables
color_fill <- "#CD6771"
color_two <- "#0D5047"
color_border <- "#F6A4AC"

# Helper functions for the code

histogram_helper <- function(variable, xlab, bwidth) {
  histogram <- ggplot(food_data_germany, aes(variable)) +
    geom_histogram(binwidth = bwidth, fill = color_fill, colour = color_border) +
    labs(x = xlab)
  return(histogram)
}
```

```{r echo=FALSE, cache=TRUE, Load_the_Data}
setwd("~/Repositories/Udacity_Explore-and-Summarize-Data")
food_data <- read.csv(file.path("data", "FoodFacts.csv"), header = TRUE, sep = ",", stringsAsFactors = TRUE)
```

# Data Cleaning
```{r, echo=FALSE}
dim(food_data)
```

There are in total `r nrow(food_data)` food products in the dataset. Each food product has `r ncol(food_data)` variables. Not every variable will be of interest for this analysis. I will focus my analysis on products from Germany.

```{r, echo=FALSE}
food_data_germany <- filter(food_data, countries_en == "Germany")
```

When I filter the database for German products the entire database is reduced `r nrow(food_data_germany)` products. In order to select variables that contain meaningful information we have to filter the dataset for NAs. Variables with a lot of NAs should not be included in the analysis. For this analysis I will set the cutoff for variables that have less than 40% of NAs.

```{r, echo=FALSE, warning=FALSE}
# Code taken and accustomed from
# https://www.kaggle.com/jelaurent/d/openfoodfacts/world-food-facts/openfoodfacts-exploring-the-dataset/notebook
na_variables <- food_data_germany %>%
  melt(measure.vars = 1:159) %>%
  group_by(variable) %>% 
  summarize(perc_na = round(sum(is.na(value))/length(value), digits = 3)) %>%
  arrange(desc(perc_na)) %>%
  filter(perc_na > .4) %>%
  as.data.frame
```

```{r, echo=FALSE, warning=FALSE, cache=TRUE}
food_germany <- select(food_data_germany, product_name, generic_name,
                                      brands, categories_en, origins, pnns_groups_1,
                                      pnns_groups_2, manufacturing_places, additives_en,
                                      nutrition_grade_fr, main_category_en, energy_100g, 
                                      fat_100g, saturated_fat_100g, carbohydrates_100g, 
                                      sugars_100g, proteins_100g, salt_100g, 
                                      nutrition_score_fr_100g, nutrition_score_uk_100g)
glimpse(food_germany)
```

We managed to drill down the database to `r ncol(food_germany)` variables. There variables now contain less than 40% of NAs and can be used for further analysis.


# Univariate Plots Section

## Macronutritions
I will begin to explore the **macronutritions** in the dataset. That is, **fat**, **proteins**, and **carbohydrates**. 

```{r, echo=FALSE}
histogram_helper(food_germany$fat_100g, "fat_100g", bwidth = 2)
```

Most products do not contain a lot of **fat**. The distribution is **skewed left**. Very few products contain a lot of fat. 

For the purpose of a healthy diet is is crucial to investigate **saturated fat** as it has been linked to cardiovascular diseases.

```{r, echo=FALSE}
histogram_helper(food_germany$saturated_fat_100g, "saturated_fat_100g", bwidth = 2)
```

It seems that most products do not contain a lot of **saturated fat**. Indeed there is tiny peak of products that contain around 50g of saturated fat per 100g.

```{r, echo=FALSE}
histogram_helper(food_germany$proteins_100g, "protein_100g", bwidth = 2)
```

The distribution of **protein** is more **skewed to the left** than the distribution of fat. There are few products with a lot of protein. I suppose these are **food supplements** for weight loss or muscle training. 

```{r, echo=FALSE}
histogram_helper(food_germany$carbohydrates_100g, "carbohydrates_100g", bwidth = 2)
```

The distribution of **carbohydrates** is more evenly distributed than the distribution of fat or proteins. Most products do not contain a lot of carbohydrates. The distribution is slightly **bimodal**, indicating two different sort of products. 

## Nutritional Value
The database has two variables that give information about the nutritional value of the products. There is a score from France (**nutrition_score_fr_100g**) and a score from the UK (**nutrition_score_uk_100g**). Let us see how they differ.

```{r, echo=FALSE}
nutrition_score_dataframe <- food_germany %>%
  melt(measure.vars = 19:20)
  
ggplot(nutrition_score_dataframe, aes(x = value)) +
  geom_histogram(binwidth = 2, fill = color_fill, colour = color_border) +
    labs(x = "Nutrional Value") +
    facet_wrap(~ variable)

ggplot(nutrition_score_dataframe, aes(x = value, fill = variable)) +
  geom_histogram(binwidth = 1, position="identity", alpha = 0.2) +
    labs(x = "Nutrional Value")
```

Obviously the variables are not drastically different from another. For further analysis I will stick to the **French** system.

From a first glimpse at the nutritional value, the distribution looks a little bit **bimodal**. There is a high peak at around a score of 0. These might be water products that are neither nutritional valuable nor non-valuable. Another peak seems to be around a score of 15. 

Let us dive deeper into the nutritional value of different food categories. The **pnns_groups_1** variable contains information of the product types.

```{r, echo=FALSE}
# Borrowed idea from jlaurent:
# https://www.kaggle.com/jelaurent/d/openfoodfacts/world-food-facts/openfoodfacts-exploring-the-dataset/notebook
food_germany$pnns_groups_1 <- gsub("^([a-z])(\\w+)", "\\U\\1\\L\\2", food_germany$pnns_groups_1, perl = TRUE)
food_germany$pnns_groups_1 <- as.factor(gsub("-", " ", food_germany$pnns_groups_1))

ggplot(food_germany, aes(x = nutrition_score_fr_100g)) +
  geom_histogram(binwidth = 2, fill = color_fill, colour = color_border) +
    labs(x = "Nutrional Value") +
    facet_wrap(~ pnns_groups_1)
```

**Sugary** snacks obviously are not very healthy. Appart from sugary snacks there is no product type that is of bad nutritional value per se. **Cereals and potatoes** seem to be beneficial for health. The same goes for **Fruits and vegetables**. **Milk and dairy products** have a bimodal distribution. This indicates that half of these products are not very healthy. **Beverages** by and large seem to be reasonably good. The peak of the distribution might be because of **water products**. 

## Other variables

```{r, echo=FALSE}
food_germany$kcal_100g <- food_germany$energy_100g * 0.239006
histogram_helper(food_germany$kcal_100g, "kcal_100g", bwidth = 10)
```

Energy in food is most often measured in **kilojoule**. Customers are usually more accustomed to **kilocalories**. Therefore I created a new variable **kcal_100g** that used the conversion of the following website: http://www.rapidtables.com/convert/energy/kj-to-kcal.htm. 

The distribution has three peaks and is skewed left. The mean is `r mean(food_germany$kcal_100g, na.rm = TRUE)`. 

```{r, echo=FALSE}
histogram_helper(food_germany$salt_100g, "salt_100g", bwidth = 1)
```

There is not much **salt** in most products. Just very few have a lot of salt. I reckon these are salt products :) 

It would be also interesting to find out which brands produce most products.

```{r, echo=FALSE}
common_brands_vector <- sort(table(food_germany$brands), decreasing = TRUE)[2:30]
common_brands_names <- names(common_brands_vector)
common_brands_df <- data.frame(brands = common_brands_names, frequency = common_brands_vector)
common_brands_df <- transform(common_brands_df, brands = reorder(brands, -frequency))

ggplot(common_brands_df, aes(x = brands, y = frequency)) + 
  geom_bar(stat = "identity", fill = color_fill, color = color_border) +
   theme(axis.text.x = element_text(angle = 90, hjust = 1))

```

Most products sold in Germany are made by **Gut & GÃ¼nstig**. **Alnature** comes in second place. 

# Univariate Analysis

### What is the structure of your dataset?
There are `r nrow(food_germany)` products with `r ncol(food_germany)` features in the dataset. 

```{r, echo=FALSE}
apply(food_germany, 2, function(x) sum(is.na(x)) / length(x))
```

Many features do not contain any missing values. Most features that contain nutritional values contain missing values at around 30%. 

```{r, echo=FALSE}
glimpse(food_germany)
```

The dataset contains factors and numerics. The factor's level differ heavily. There are features with just 6 levels and features with over 20,000 levels. 


### What is/are the main feature(s) of interest in your dataset?

The main features of the dataset are features that contain information that is relevant for a healthy diet. These are all **macronutritions**, **nutritional_score_fr_100g**, and **kcal_100g**.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
It would be very interesting to search for patterns that depend on the **brands** and the product groups (**pnns_group_1**). There might be brands that produce products that tend to be unhealty or healthy. It would be also interesting to find out what makes some products healthier than others. We already saw that **cereals** and **fruit and vegetables** are nutritionally valuable. But why? We might investigate their **macronutrition distribution**.

### Did you create any new variables from existing variables in the dataset?
I created a new variable **kcal_100g**. I am more accustomed to kcal than kilojoule as an indicator of energy. In order to find the most common **brands** I created the dataframe **common_brands_df**. 


### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
The dataset initially had too many features. I reduced the dataset mainly to features that contain less than 40% of missing values. I also only selected products from Germany as these are of special interest for my analysis. 
I changed the variable **pnns_groups_1** with some regex to make it more readable and in order to catch spelling mistakes. 

# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}

```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
